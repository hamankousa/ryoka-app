# E2Eチェックリスト（機内モード対応）

対象: iOS/Android 実機（Webは一部確認のみ）

## 0. 事前準備

1. ターミナル1（配信）

```bash
npx serve . -l 8787 --cors
```

2. ターミナル2（アプリ）

```bash
$env:EXPO_PUBLIC_MANIFEST_BASE_URL="http://<PCのIP>:8787/ryoka-content/"
npm run start
```

3. 実機を同一Wi-Fiへ接続して起動

## 1. タブ初期表示

- 下部タブに `ホーム / 検索 / 一覧 / ライブラリ` が表示される
- どのタブでも下部にミニプレイヤー（未選択時は `未選択`）が見える
- ホームのクイックアクションから各タブへ遷移できる

## 2. 検索タブ

- キーワード入力で曲名/年度/作歌作曲/ID検索ができる
- 元号チップを押すと年度クイック検索が有効になる
- 年次が多い場合は `年代 -> 年次` の順で絞り込める
- 下部に絞り込み後の一覧が表示される
- 各曲の `Vocal/Piano` 再生、`歌詞/楽譜` 遷移が動く

## 3. 一覧タブ（高密度表示）

- 元号セクションごとに曲数付きで表示される
- 1行に `曲名 / ID+年度 / 作歌作曲 / 再生ボタン / 歌詞楽譜リンク` が収まる
- モバイルで縦スクロールしながら連続操作できる

## 4. 共通ミニプレイヤー

- 検索または一覧から再生を開始すると全タブで同じ再生状態が見える
- 最小化状態でシークバーと時間（現在/総時間）が表示される
- 最小化バーのシークトラックタップでシークできる
- タブを切り替えても再生中曲が未選択に戻らない

## 5. 展開プレイヤー

- 中央: 再生/一時停止
- 左右対称: 戻る/進む
- 外側: シャッフル（左）/ループ（右）
- 戻るは再生位置5秒以上で曲頭へ戻る、5秒未満で前曲へ移る
- ループボタンは `off -> playlist -> track -> off` で状態遷移する
- 歌詞パネルが表示され、`Vocal/Piano` 切替ができる

## 6. ダウンロード（iOS/Androidのみ）

- 一覧タブでDL開始すると進捗が `%` で表示される
- 完了後に `DL状態: 済` になる
- 削除で `DL状態: 未` に戻る
- ライブラリタブに保存曲数と保存曲一覧が反映される

## 7. 機内モード

1. 1曲以上をダウンロード済みにする
2. 実機を機内モードへ切り替える
3. ダウンロード済み曲で以下を確認
- 再生できる
- 歌詞表示できる
- 楽譜表示できる
4. 未DL曲はオフライン再生できない

## 8. 更新検知

1. `ryoka-content/manifest.json` の対象曲 `updatedAt` または `hash/size` を変更
2. アプリを再読み込み
3. 対象曲が `更新あり` 表示になる
4. 再DL後に `済` へ戻る
